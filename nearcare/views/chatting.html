{% extends 'index.html' %}
{% block content %}
    <div id="div_chatting_page_content_all">
        <div id="div_chatting_page_title">
            <p>AI 챗봇</p>
        </div>
        

        <div id="div_chatting_page_content">
            <div class="div1_chatting_space">
                <div class="chat_bubble_group_all" id="chatbotMessages">
                    <!--챗봇 프로필-->
                    <div class="img_profile_chatbot">
                        <div class="img_profile_chatbot_bg"></div>
                        <div class="div_img_profile_chatbot_icon">
                            <img src="/images/profile_chatbot_icon.png" class="img_profile_chatbot_icon">
                        </div>
                    </div>

                    <!-- ai 말풍선 -->
                
                    <div class="chat_bubble_group">
                        <div class="chat_bubble_big"></div>
                        <span class="chatbot_text">안녕하세요. 따숨 챗봇입니다. 무엇을 도와드릴까요?</span>
                    </div>
                </div> <!-- ai 말풍선 끝-->


                <!--사용자 말풍선-->
                <div class="chat_bubble_group_all" id="userMessages">
                    <div class="chat_bubble_group_user">
                        <div class="chat_bubble_big_user"></div>
                        <span class="user_text">뭐라뭐라</span>
                    </div>
                </div>


            </div>
            

        </div>

            <div class="div2_sending_space">
                <form id="chatForm">
                    <label for="input_chat"></label>
                    <input class="input_chat" type="text" id="input_chat" name="userInputText">
                    <button class="btn_chat" type="submit" id="btn_chat">
                        <div class="btn_chat_bg"></div>
                        <div class="btn_chat_airplane"></div>
                    </button>
                </form>
            </div>
        </div>
    </div>

<script>
    document.getElementById('chatForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        const userInput = document.getElementById('input_chat').value;
        if (userInput.trim() === '') return;

        // 사용자 입력을 화면에 표시
        const userMessages = document.getElementById('userMessages');
        const userMessageDiv = document.createElement('div');
        userMessageDiv.classList.add('chat_bubble_group_user');
        userMessageDiv.innerHTML = `<div class="chat_bubble_big_user"></div>
                                    <span class="user_text">${userInput}</span>`;
        userMessages.appendChild(userMessageDiv);

        // 서버로 사용자 입력 전송
        try {
            const response = await fetch('/chatting/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ userInputText: userInput })
            });

            const data = await response.json();
            const chatbotMessages = document.getElementById('chatbotMessages');

            if (data.gptResponse) {
                // ChatGPT 응답을 화면에 표시
                const chatbotMessageDiv = document.createElement('div');
                chatbotMessageDiv.classList.add('chat_bubble_group');
                chatbotMessageDiv.innerHTML = `<div class="chat_bubble_big"></div>
                                               <div class="chat_bubble_small"></div>
                                               <span class="chatbot_text">${data.gptResponse}</span>`;
                chatbotMessages.appendChild(chatbotMessageDiv);
            } else {
                console.error('ChatGPT 응답 없음');
            }
        } catch (error) {
            console.error('오류 발생:', error);
        }

        // 입력 필드 비우기
        document.getElementById('input_chat').value = '';
    });
</script>
{% endblock %}
